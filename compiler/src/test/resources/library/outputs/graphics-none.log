
Final code before resolving virtual instructions:

        label *label1
    0:  jump *label1 equal display1 null
        label *label2
    1:  jump *label2 equal display2 null
        label *label3
    2:  jump *label3 equal display3 null
        label *label4
    3:  jump *label4 equal display4 null
        label *label5
    4:  jump *label5 equal display5 null
    5:  set :displaySize:display display1
    6:  setaddr :displaySize*retaddr *label6
    7:  call *label0 *invalid :displaySize*retval
        label *label6
    8:  set *tmp0 :displaySize*retval
    9:  assertequals 176 *tmp0 "large display size"
   10:  set :displaySize:display display5
   11:  setaddr :displaySize*retaddr *label7
   12:  call *label0 *invalid :displaySize*retval
        label *label7
   13:  set *tmp1 :displaySize*retval
   14:  assertequals 80 *tmp1 "small display size"
   15:  set :x %336699cc
   16:  set :unpackcolor:packedColor :x
   17:  op div *tmp2 :unpackcolor:packedColor %00000001
   18:  set :unpackcolor:bits *tmp2
   19:  op and *tmp3 :unpackcolor:bits 4278190080
   20:  op div *tmp4 *tmp3 4278190080
   21:  set :unpackcolor:r *tmp4
   22:  op and *tmp5 :unpackcolor:bits 16711680
   23:  op div *tmp6 *tmp5 16711680
   24:  set :unpackcolor:g *tmp6
   25:  op and *tmp7 :unpackcolor:bits 65280
   26:  op div *tmp8 *tmp7 65280
   27:  set :unpackcolor:b *tmp8
   28:  op and *tmp9 :unpackcolor:bits 255
   29:  op div *tmp10 *tmp9 255
   30:  set :unpackcolor:a *tmp10
        label *label8
   31:  set :r :unpackcolor:r
   32:  set :g :unpackcolor:g
   33:  set :b :unpackcolor:b
   34:  set :a :unpackcolor:a
   35:  assertequals 0.2 :r "red channel"
   36:  assertequals 0.4 :g "green channel"
   37:  assertequals 0.6 :b "blue channel"
   38:  assertequals 0.8 :a "alpha channel"
   39:  draw rotate 0 0 90 0 0 0
   40:  draw translate 0 -80 0 0 0 0
        label *label9
   41:  draw rotate 0 0 270 0 0 0
   42:  draw translate -80 0 0 0 0 0
        label *label10
   43:  draw rotate 0 0 180 0 0 0
   44:  draw translate -80 -80 0 0 0 0
        label *label11
   45:  draw scale 1 -1 0 0 0 0
   46:  draw translate 0 -80 0 0 0 0
        label *label12
   47:  draw scale -1 1 0 0 0 0
   48:  draw translate -80 0 0 0 0 0
        label *label13
   49:  draw rotate 0 0 90 0 0 0
   50:  draw translate 0 -176 0 0 0 0
        label *label14
   51:  draw rotate 0 0 270 0 0 0
   52:  draw translate -176 0 0 0 0 0
        label *label15
   53:  draw rotate 0 0 180 0 0 0
   54:  draw translate -176 -176 0 0 0 0
        label *label16
   55:  draw scale 1 -1 0 0 0 0
   56:  draw translate 0 -176 0 0 0 0
        label *label17
   57:  draw scale -1 1 0 0 0 0
   58:  draw translate -176 0 0 0 0 0
        label *label18
   59:  set :rotateLeft:display display1
   60:  sensor *tmp12 :rotateLeft:display @type
   61:  set *tmp13 *tmp12
   62:  jump *label22 equal *tmp13 @logic-display
   63:  jump *label21 always 0 0
        label *label22
   64:  draw rotate 0 0 90 0 0 0
   65:  draw translate 0 -80 0 0 0 0
        label *label23
   66:  set *tmp11 null
   67:  jump *label20 always 0 0
        label *label21
   68:  jump *label25 equal *tmp13 @large-logic-display
   69:  jump *label24 always 0 0
        label *label25
   70:  draw rotate 0 0 90 0 0 0
   71:  draw translate 0 -176 0 0 0 0
        label *label26
   72:  set *tmp11 null
   73:  jump *label20 always 0 0
        label *label24
   74:  stop
   75:  set *tmp11 null
        label *label20
        label *label19
   76:  set :rotateRight:display display2
   77:  sensor *tmp15 :rotateRight:display @type
   78:  set *tmp16 *tmp15
   79:  jump *label30 equal *tmp16 @logic-display
   80:  jump *label29 always 0 0
        label *label30
   81:  draw rotate 0 0 270 0 0 0
   82:  draw translate -80 0 0 0 0 0
        label *label31
   83:  set *tmp14 null
   84:  jump *label28 always 0 0
        label *label29
   85:  jump *label33 equal *tmp16 @large-logic-display
   86:  jump *label32 always 0 0
        label *label33
   87:  draw rotate 0 0 270 0 0 0
   88:  draw translate -176 0 0 0 0 0
        label *label34
   89:  set *tmp14 null
   90:  jump *label28 always 0 0
        label *label32
   91:  stop
   92:  set *tmp14 null
        label *label28
        label *label27
   93:  set :upsideDown:display display3
   94:  sensor *tmp18 :upsideDown:display @type
   95:  set *tmp19 *tmp18
   96:  jump *label38 equal *tmp19 @logic-display
   97:  jump *label37 always 0 0
        label *label38
   98:  draw rotate 0 0 180 0 0 0
   99:  draw translate -80 -80 0 0 0 0
        label *label39
  100:  set *tmp17 null
  101:  jump *label36 always 0 0
        label *label37
  102:  jump *label41 equal *tmp19 @large-logic-display
  103:  jump *label40 always 0 0
        label *label41
  104:  draw rotate 0 0 180 0 0 0
  105:  draw translate -176 -176 0 0 0 0
        label *label42
  106:  set *tmp17 null
  107:  jump *label36 always 0 0
        label *label40
  108:  stop
  109:  set *tmp17 null
        label *label36
        label *label35
  110:  set :flipVertical:display display4
  111:  sensor *tmp21 :flipVertical:display @type
  112:  set *tmp22 *tmp21
  113:  jump *label46 equal *tmp22 @logic-display
  114:  jump *label45 always 0 0
        label *label46
  115:  draw scale 1 -1 0 0 0 0
  116:  draw translate 0 -80 0 0 0 0
        label *label47
  117:  set *tmp20 null
  118:  jump *label44 always 0 0
        label *label45
  119:  jump *label49 equal *tmp22 @large-logic-display
  120:  jump *label48 always 0 0
        label *label49
  121:  draw scale 1 -1 0 0 0 0
  122:  draw translate 0 -176 0 0 0 0
        label *label50
  123:  set *tmp20 null
  124:  jump *label44 always 0 0
        label *label48
  125:  stop
  126:  set *tmp20 null
        label *label44
        label *label43
  127:  set :flipHorizontal:display display5
  128:  sensor *tmp24 :flipHorizontal:display @type
  129:  set *tmp25 *tmp24
  130:  jump *label54 equal *tmp25 @logic-display
  131:  jump *label53 always 0 0
        label *label54
  132:  draw scale -1 1 0 0 0 0
  133:  draw translate -80 0 0 0 0 0
        label *label55
  134:  set *tmp23 null
  135:  jump *label52 always 0 0
        label *label53
  136:  jump *label57 equal *tmp25 @large-logic-display
  137:  jump *label56 always 0 0
        label *label57
  138:  draw scale -1 1 0 0 0 0
  139:  draw translate -176 0 0 0 0 0
        label *label58
  140:  set *tmp23 null
  141:  jump *label52 always 0 0
        label *label56
  142:  stop
  143:  set *tmp23 null
        label *label52
        label *label51
  144:  draw scale 2.2 2.2 0 0 0 0
        label *label59
  145:  draw scale 0.45454545454545453 0.45454545454545453 0 0 0 0
        label *label60
  146:  end
        label *label0
  147:  sensor *tmp26 :displaySize:display @type
  148:  set :displaySize:type *tmp26
  149:  op equal *tmp27 :displaySize:type @logic-display
  150:  jump *label62 equal *tmp27 false
  151:  set *tmp28 80
  152:  jump *label63 always 0 0
        label *label62
  153:  op equal *tmp29 :displaySize:type @large-logic-display
  154:  jump *label64 equal *tmp29 false
  155:  set *tmp30 176
  156:  jump *label65 always 0 0
        label *label64
  157:  set *tmp30 null
        label *label65
  158:  set *tmp28 *tmp30
        label *label63
  159:  set :displaySize*retval *tmp28
        label *label61
  160:  return :displaySize*retaddr
  161:  end
