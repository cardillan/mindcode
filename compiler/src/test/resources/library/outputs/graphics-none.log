
Final code before resolving virtual instructions:

        label *label3
    0:  jump *label3 equal display1 null
        label *label4
    1:  jump *label4 equal display2 null
        label *label5
    2:  jump *label5 equal display3 null
        label *label6
    3:  jump *label6 equal display4 null
        label *label7
    4:  jump *label7 equal display5 null
    5:  set :displaySize:display display1
    6:  setaddr :displaySize*retaddr *label8
    7:  call *label2 *invalid :displaySize*retval
        label *label8
    8:  set *tmp0 :displaySize*retval
    9:  assertequals 176 *tmp0 "large display size"
   10:  set :displaySize:display display5
   11:  setaddr :displaySize*retaddr *label9
   12:  call *label2 *invalid :displaySize*retval
        label *label9
   13:  set *tmp1 :displaySize*retval
   14:  assertequals 80 *tmp1 "small display size"
   15:  set :x %336699cc
   16:  set :unpackcolor:packedColor :x
   17:  op div *tmp2 :unpackcolor:packedColor %00000001
   18:  set :unpackcolor:bits *tmp2
   19:  op and *tmp3 :unpackcolor:bits 4278190080
   20:  op div *tmp4 *tmp3 4278190080
   21:  set :unpackcolor:r *tmp4
   22:  op and *tmp5 :unpackcolor:bits 16711680
   23:  op div *tmp6 *tmp5 16711680
   24:  set :unpackcolor:g *tmp6
   25:  op and *tmp7 :unpackcolor:bits 65280
   26:  op div *tmp8 *tmp7 65280
   27:  set :unpackcolor:b *tmp8
   28:  op and *tmp9 :unpackcolor:bits 255
   29:  op div *tmp10 *tmp9 255
   30:  set :unpackcolor:a *tmp10
        label *label10
   31:  set :r :unpackcolor:r
   32:  set :g :unpackcolor:g
   33:  set :b :unpackcolor:b
   34:  set :a :unpackcolor:a
   35:  assertequals 0.2 :r "red channel"
   36:  assertequals 0.4 :g "green channel"
   37:  assertequals 0.6 :b "blue channel"
   38:  assertequals 0.8 :a "alpha channel"
   39:  draw rotate 0 0 90 0 0 0
   40:  draw translate 0 -80 0 0 0 0
        label *label11
   41:  draw rotate 0 0 270 0 0 0
   42:  draw translate -80 0 0 0 0 0
        label *label12
   43:  draw rotate 0 0 180 0 0 0
   44:  draw translate -80 -80 0 0 0 0
        label *label13
   45:  draw scale 1 -1 0 0 0 0
   46:  draw translate 0 -80 0 0 0 0
        label *label14
   47:  draw scale -1 1 0 0 0 0
   48:  draw translate -80 0 0 0 0 0
        label *label15
   49:  draw rotate 0 0 90 0 0 0
   50:  draw translate 0 -176 0 0 0 0
        label *label16
   51:  draw rotate 0 0 270 0 0 0
   52:  draw translate -176 0 0 0 0 0
        label *label17
   53:  draw rotate 0 0 180 0 0 0
   54:  draw translate -176 -176 0 0 0 0
        label *label18
   55:  draw scale 1 -1 0 0 0 0
   56:  draw translate 0 -176 0 0 0 0
        label *label19
   57:  draw scale -1 1 0 0 0 0
   58:  draw translate -176 0 0 0 0 0
        label *label20
   59:  set :rotateLeft:display display1
   60:  sensor *tmp12 :rotateLeft:display @type
   61:  set *tmp13 *tmp12
   62:  jump *label24 equal *tmp13 @logic-display
   63:  jump *label23 always 0 0
        label *label24
   64:  draw rotate 0 0 90 0 0 0
   65:  draw translate 0 -80 0 0 0 0
        label *label25
   66:  set *tmp11 null
   67:  jump *label22 always 0 0
        label *label23
   68:  jump *label27 equal *tmp13 @large-logic-display
   69:  jump *label26 always 0 0
        label *label27
   70:  draw rotate 0 0 90 0 0 0
   71:  draw translate 0 -176 0 0 0 0
        label *label28
   72:  set *tmp11 null
   73:  jump *label22 always 0 0
        label *label26
   74:  stop
   75:  set *tmp11 null
        label *label22
        label *label21
   76:  set :rotateRight:display display2
   77:  sensor *tmp15 :rotateRight:display @type
   78:  set *tmp16 *tmp15
   79:  jump *label32 equal *tmp16 @logic-display
   80:  jump *label31 always 0 0
        label *label32
   81:  draw rotate 0 0 270 0 0 0
   82:  draw translate -80 0 0 0 0 0
        label *label33
   83:  set *tmp14 null
   84:  jump *label30 always 0 0
        label *label31
   85:  jump *label35 equal *tmp16 @large-logic-display
   86:  jump *label34 always 0 0
        label *label35
   87:  draw rotate 0 0 270 0 0 0
   88:  draw translate -176 0 0 0 0 0
        label *label36
   89:  set *tmp14 null
   90:  jump *label30 always 0 0
        label *label34
   91:  stop
   92:  set *tmp14 null
        label *label30
        label *label29
   93:  set :upsideDown:display display3
   94:  sensor *tmp18 :upsideDown:display @type
   95:  set *tmp19 *tmp18
   96:  jump *label40 equal *tmp19 @logic-display
   97:  jump *label39 always 0 0
        label *label40
   98:  draw rotate 0 0 180 0 0 0
   99:  draw translate -80 -80 0 0 0 0
        label *label41
  100:  set *tmp17 null
  101:  jump *label38 always 0 0
        label *label39
  102:  jump *label43 equal *tmp19 @large-logic-display
  103:  jump *label42 always 0 0
        label *label43
  104:  draw rotate 0 0 180 0 0 0
  105:  draw translate -176 -176 0 0 0 0
        label *label44
  106:  set *tmp17 null
  107:  jump *label38 always 0 0
        label *label42
  108:  stop
  109:  set *tmp17 null
        label *label38
        label *label37
  110:  set :flipVertical:display display4
  111:  sensor *tmp21 :flipVertical:display @type
  112:  set *tmp22 *tmp21
  113:  jump *label48 equal *tmp22 @logic-display
  114:  jump *label47 always 0 0
        label *label48
  115:  draw scale 1 -1 0 0 0 0
  116:  draw translate 0 -80 0 0 0 0
        label *label49
  117:  set *tmp20 null
  118:  jump *label46 always 0 0
        label *label47
  119:  jump *label51 equal *tmp22 @large-logic-display
  120:  jump *label50 always 0 0
        label *label51
  121:  draw scale 1 -1 0 0 0 0
  122:  draw translate 0 -176 0 0 0 0
        label *label52
  123:  set *tmp20 null
  124:  jump *label46 always 0 0
        label *label50
  125:  stop
  126:  set *tmp20 null
        label *label46
        label *label45
  127:  set :flipHorizontal:display display5
  128:  sensor *tmp24 :flipHorizontal:display @type
  129:  set *tmp25 *tmp24
  130:  jump *label56 equal *tmp25 @logic-display
  131:  jump *label55 always 0 0
        label *label56
  132:  draw scale -1 1 0 0 0 0
  133:  draw translate -80 0 0 0 0 0
        label *label57
  134:  set *tmp23 null
  135:  jump *label54 always 0 0
        label *label55
  136:  jump *label59 equal *tmp25 @large-logic-display
  137:  jump *label58 always 0 0
        label *label59
  138:  draw scale -1 1 0 0 0 0
  139:  draw translate -176 0 0 0 0 0
        label *label60
  140:  set *tmp23 null
  141:  jump *label54 always 0 0
        label *label58
  142:  stop
  143:  set *tmp23 null
        label *label54
        label *label53
  144:  set :scaleDisplay:x 2.2
  145:  set :scaleDisplay:y 2.2
  146:  op add *tmp26 :scaleDisplay:x 0.025
  147:  op add *tmp27 :scaleDisplay:y 0.025
  148:  draw scale *tmp26 *tmp27 0 0 0 0
        label *label62
        label *label61
  149:  set :scaleDisplay.1:x 0.45454545454545453
  150:  set :scaleDisplay.1:y 0.45454545454545453
  151:  op add *tmp28 :scaleDisplay.1:x 0.025
  152:  op add *tmp29 :scaleDisplay.1:y 0.025
  153:  draw scale *tmp28 *tmp29 0 0 0 0
        label *label64
        label *label63
  154:  end
        label *label2
  155:  sensor *tmp30 :displaySize:display @type
  156:  set :displaySize:type *tmp30
  157:  op equal *tmp31 :displaySize:type @logic-display
  158:  jump *label66 equal *tmp31 false
  159:  set *tmp32 80
  160:  jump *label67 always 0 0
        label *label66
  161:  op equal *tmp33 :displaySize:type @large-logic-display
  162:  jump *label68 equal *tmp33 false
  163:  set *tmp34 176
  164:  jump *label69 always 0 0
        label *label68
  165:  set *tmp34 null
        label *label69
  166:  set *tmp32 *tmp34
        label *label67
  167:  set :displaySize*retval *tmp32
        label *label65
  168:  return :displaySize*retaddr
  169:  end
