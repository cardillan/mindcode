
Final code before resolving virtual instructions:

    0:  set :displaySize:display display1
    1:  setaddr :displaySize*retaddr *label3
    2:  call *label2 *invalid :displaySize*retval
        label *label3
    3:  set *tmp0 :displaySize*retval
    4:  assertequals 176 *tmp0 "large display size"
    5:  set :displaySize:display display5
    6:  setaddr :displaySize*retaddr *label4
    7:  call *label2 *invalid :displaySize*retval
        label *label4
    8:  set *tmp1 :displaySize*retval
    9:  assertequals 80 *tmp1 "small display size"
   10:  set :x %336699cc
   11:  set :unpackcolor:packedColor :x
   12:  op div *tmp2 :unpackcolor:packedColor %00000001
   13:  set :unpackcolor:bits *tmp2
   14:  op and *tmp3 :unpackcolor:bits 4278190080
   15:  op div *tmp4 *tmp3 4278190080
   16:  set :unpackcolor:r *tmp4
   17:  op and *tmp5 :unpackcolor:bits 16711680
   18:  op div *tmp6 *tmp5 16711680
   19:  set :unpackcolor:g *tmp6
   20:  op and *tmp7 :unpackcolor:bits 65280
   21:  op div *tmp8 *tmp7 65280
   22:  set :unpackcolor:b *tmp8
   23:  op and *tmp9 :unpackcolor:bits 255
   24:  op div *tmp10 *tmp9 255
   25:  set :unpackcolor:a *tmp10
        label *label5
   26:  set :r :unpackcolor:r
   27:  set :g :unpackcolor:g
   28:  set :b :unpackcolor:b
   29:  set :a :unpackcolor:a
   30:  assertequals 0.2 :r "red channel"
   31:  assertequals 0.4 :g "green channel"
   32:  assertequals 0.6 :b "blue channel"
   33:  assertequals 0.8 :a "alpha channel"
   34:  draw rotate 0 0 90 0 0 0
   35:  draw translate 0 -80 0 0 0 0
        label *label6
   36:  draw rotate 0 0 270 0 0 0
   37:  draw translate -80 0 0 0 0 0
        label *label7
   38:  draw rotate 0 0 180 0 0 0
   39:  draw translate -80 -80 0 0 0 0
        label *label8
   40:  draw scale 1 -1 0 0 0 0
   41:  draw translate 0 -80 0 0 0 0
        label *label9
   42:  draw scale -1 1 0 0 0 0
   43:  draw translate -80 0 0 0 0 0
        label *label10
   44:  draw rotate 0 0 90 0 0 0
   45:  draw translate 0 -176 0 0 0 0
        label *label11
   46:  draw rotate 0 0 270 0 0 0
   47:  draw translate -176 0 0 0 0 0
        label *label12
   48:  draw rotate 0 0 180 0 0 0
   49:  draw translate -176 -176 0 0 0 0
        label *label13
   50:  draw scale 1 -1 0 0 0 0
   51:  draw translate 0 -176 0 0 0 0
        label *label14
   52:  draw scale -1 1 0 0 0 0
   53:  draw translate -176 0 0 0 0 0
        label *label15
   54:  set :rotateLeft:display display1
   55:  sensor *tmp12 :rotateLeft:display @type
   56:  set *tmp13 *tmp12
   57:  jump *label19 equal *tmp13 @logic-display
   58:  jump *label18 always 0 0
        label *label19
   59:  draw rotate 0 0 90 0 0 0
   60:  draw translate 0 -80 0 0 0 0
        label *label20
   61:  set *tmp11 null
   62:  jump *label17 always 0 0
        label *label18
   63:  jump *label22 equal *tmp13 @large-logic-display
   64:  jump *label21 always 0 0
        label *label22
   65:  draw rotate 0 0 90 0 0 0
   66:  draw translate 0 -176 0 0 0 0
        label *label23
   67:  set *tmp11 null
   68:  jump *label17 always 0 0
        label *label21
   69:  stop
   70:  set *tmp11 null
        label *label17
        label *label16
   71:  set :rotateRight:display display2
   72:  sensor *tmp15 :rotateRight:display @type
   73:  set *tmp16 *tmp15
   74:  jump *label27 equal *tmp16 @logic-display
   75:  jump *label26 always 0 0
        label *label27
   76:  draw rotate 0 0 270 0 0 0
   77:  draw translate -80 0 0 0 0 0
        label *label28
   78:  set *tmp14 null
   79:  jump *label25 always 0 0
        label *label26
   80:  jump *label30 equal *tmp16 @large-logic-display
   81:  jump *label29 always 0 0
        label *label30
   82:  draw rotate 0 0 270 0 0 0
   83:  draw translate -176 0 0 0 0 0
        label *label31
   84:  set *tmp14 null
   85:  jump *label25 always 0 0
        label *label29
   86:  stop
   87:  set *tmp14 null
        label *label25
        label *label24
   88:  set :upsideDown:display display3
   89:  sensor *tmp18 :upsideDown:display @type
   90:  set *tmp19 *tmp18
   91:  jump *label35 equal *tmp19 @logic-display
   92:  jump *label34 always 0 0
        label *label35
   93:  draw rotate 0 0 180 0 0 0
   94:  draw translate -80 -80 0 0 0 0
        label *label36
   95:  set *tmp17 null
   96:  jump *label33 always 0 0
        label *label34
   97:  jump *label38 equal *tmp19 @large-logic-display
   98:  jump *label37 always 0 0
        label *label38
   99:  draw rotate 0 0 180 0 0 0
  100:  draw translate -176 -176 0 0 0 0
        label *label39
  101:  set *tmp17 null
  102:  jump *label33 always 0 0
        label *label37
  103:  stop
  104:  set *tmp17 null
        label *label33
        label *label32
  105:  set :flipVertical:display display4
  106:  sensor *tmp21 :flipVertical:display @type
  107:  set *tmp22 *tmp21
  108:  jump *label43 equal *tmp22 @logic-display
  109:  jump *label42 always 0 0
        label *label43
  110:  draw scale 1 -1 0 0 0 0
  111:  draw translate 0 -80 0 0 0 0
        label *label44
  112:  set *tmp20 null
  113:  jump *label41 always 0 0
        label *label42
  114:  jump *label46 equal *tmp22 @large-logic-display
  115:  jump *label45 always 0 0
        label *label46
  116:  draw scale 1 -1 0 0 0 0
  117:  draw translate 0 -176 0 0 0 0
        label *label47
  118:  set *tmp20 null
  119:  jump *label41 always 0 0
        label *label45
  120:  stop
  121:  set *tmp20 null
        label *label41
        label *label40
  122:  set :flipHorizontal:display display5
  123:  sensor *tmp24 :flipHorizontal:display @type
  124:  set *tmp25 *tmp24
  125:  jump *label51 equal *tmp25 @logic-display
  126:  jump *label50 always 0 0
        label *label51
  127:  draw scale -1 1 0 0 0 0
  128:  draw translate -80 0 0 0 0 0
        label *label52
  129:  set *tmp23 null
  130:  jump *label49 always 0 0
        label *label50
  131:  jump *label54 equal *tmp25 @large-logic-display
  132:  jump *label53 always 0 0
        label *label54
  133:  draw scale -1 1 0 0 0 0
  134:  draw translate -176 0 0 0 0 0
        label *label55
  135:  set *tmp23 null
  136:  jump *label49 always 0 0
        label *label53
  137:  stop
  138:  set *tmp23 null
        label *label49
        label *label48
  139:  set :scaleDisplay:x 2.2
  140:  set :scaleDisplay:y 2.2
  141:  op add *tmp26 :scaleDisplay:x 0.025
  142:  op add *tmp27 :scaleDisplay:y 0.025
  143:  draw scale *tmp26 *tmp27 0 0 0 0
        label *label57
        label *label56
  144:  set :scaleDisplay.1:x 0.45454545454545453
  145:  set :scaleDisplay.1:y 0.45454545454545453
  146:  op add *tmp28 :scaleDisplay.1:x 0.025
  147:  op add *tmp29 :scaleDisplay.1:y 0.025
  148:  draw scale *tmp28 *tmp29 0 0 0 0
        label *label59
        label *label58
  149:  end
        label *label2
  150:  sensor *tmp30 :displaySize:display @type
  151:  set :displaySize:type *tmp30
  152:  op equal *tmp31 :displaySize:type @logic-display
  153:  jump *label61 equal *tmp31 false
  154:  set *tmp32 80
  155:  jump *label62 always 0 0
        label *label61
  156:  op equal *tmp33 :displaySize:type @large-logic-display
  157:  jump *label63 equal *tmp33 false
  158:  set *tmp34 176
  159:  jump *label64 always 0 0
        label *label63
  160:  set *tmp34 null
        label *label64
  161:  set *tmp32 *tmp34
        label *label62
  162:  set :displaySize*retval *tmp32
        label *label60
  163:  return :displaySize*retaddr
  164:  end
