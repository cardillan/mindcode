# Print Merging

This optimization merges two or more print instructions taking a string literal as an argument. The print instructions will get merged even if they aren't consecutive, assuming there aren't instructions that could break the print sequence (`jump`, `label` or `print <variable>`).

Effectively, this optimization eliminates a `print` instruction by turning this

```Mindcode
println("Items: ", items);
println("Time: ", @time);
```
into this:

```Mindcode
print("Items: ", items);
print("\nTime: ", @time, "\n");
```

All constant values - not just string constants - are merged. For example:

```Mindcode
const MAX_VALUE = 10;
println($"Step $i of $MAX_VALUE");
```

produces

```mlog
print "Step "
print :i
print " of 10\n"
```

On the basic optimization level, the output would be:

```
print "Step "
print i
print " of "
print 10
print "\n"
```

## The `format` instruction

The `format` instruction included in Mindustry Logic 8 allows more efficient optimizations to be done. For example, `println($"Minimum: $min, middle: $mid, maximum: $max");` without using the `format` instruction gets compiled to this:

```
print "Minimum: "
print :min
print ", middle: "
print :mid
print ", maximum: "
print :max
print "\n"
```

The optimization utilizing `format` saves three instructions by producing

```
print "Minimum: {0}, middle: {0}, maximum: {0}\n"
format :min
format :mid
format :max
```

The format instruction is used in optimization when these conditions are met:

- The language target supports the format instruction (`8.0` or later)
- The compiled code entering this optimization contains neither a string literal containing a `{0}` placeholder, nor any other substrings that could produce the `{0}` in a text buffer (for example, `print("{{1}}"); format("0");` produces `{0}` in the text buffer and disables this optimization).

If the `{0}` placeholder is avoided, the formatting mechanism can be used freely in the code without any limitations and the print merging optimization with the format instruction can still happen. To avoid the `{0}` placeholder, use placeholders starting at `{1}`:

```Mindcode
set target = 8;
param a = 10;               // prevent a from being propagated as a constant
println("{2} {1}");         // if you use "{0} {1}" instead - different optimization will happen 
format("Before");
println($"Value: $a");
format("After");
```

This program will compile to

```mlog
set a 10
print "{2} {1}\n"
format "Before"
print "Value: {0}\n"
format a
format "After"
```

and will output

```
After Before
Value: 10
```


## String length limit

On `basic` level, the optimization won't merge print instructions if the merge produces a string longer than 34 characters (36 when counting the double quotes). On `advanced` level, such instructions will be merged regardless. This can create long string constants, but according to our tests, these can be pasted into Mindustry processors even if they're longer than what the Mindustry GUI allows to enter.

## Remarks

The print merging optimization will also merge `print` instructions generated by the `remark()` function. Instructions generated by remarks are merged differently to standard `print` instructions:

* `print` instructions generated from different `remark()` function calls are never merged. Only instructions generated from a single `remark()` are merged.
* All constant values are merged regardless of the resulting string length, even on the `basic` optimization level.

If the print merging optimization is not active, instructions from `remark()` functions aren't merged.

---

[&#xAB; Previous: Loop Unrolling](LOOP-UNROLLING.markdown) &nbsp; | &nbsp; [Up: Code optimization](../SYNTAX-6-OPTIMIZATIONS.markdown) &nbsp; | &nbsp; [Next: Return Optimization &#xBB;](RETURN-OPTIMIZATION.markdown)
